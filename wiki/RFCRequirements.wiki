#summary List of concrete requirements from the XMPP RFCs
#labels Phase-QA

== RFC3920bis ==

== 3 Addresses ==

===JIDs===
Each allowable portion of a JID (node identifier, domain identifier, and resource identifier) MUST NOT be more than 1023 bytes in length, resulting in a maximum total size (including the '@' and '/' separators) of 3071 bytes. 

domain identifiers that are unqualified hostnames MUST NOT be used on public networks but MAY be used on private networks. 

===IDNA===

If the domain identifier includes a final character considered to be a label separator (dot) by [IDNA] or [DNS], this character MUST be stripped from the domain identifier before the JID of which it is a part is used for the purpose of routing an XML stanza, comparing against another JID, or constructing an [XMPP‑URI] (Saint-Andre, P., “Internationalized Resource Identifiers (IRIs) and Uniform Resource Identifiers (URIs) for the Extensible Messaging and Presence Protocol (XMPP),” February 2008.); in particular, the character MUST be stripped before any other canonicalization steps are taken, such as application of the [NAMEPREP] profile of [STRINGPREP] or completion of the ToASCII operation as described in [IDNA]. 

A domain identifier MUST be an "internationalized domain name" as defined in [IDNA], that is, "a domain name in which every label is an internationalized label". When preparing a text label (consisting of a sequence of Unicode code points) for representation as an internationalized label in the process of constructing an XMPP domain identifier or comparing two XMPP domain identifiers, an application MUST ensure that for each text label it is possible to apply without failing the ToASCII operation specified in [IDNA] with the UseSTD3ASCIIRules flag set (thus forbidding ASCII code points other than letters, digits, and hyphens).

Note: The ToASCII operation includes application of the [NAMEPREP] (Hoffman, P. and M. Blanchet, “Nameprep: A Stringprep Profile for Internationalized Domain Names (IDN),” March 2003.) profile of [STRINGPREP] and encoding using the algorithm specified in [PUNYCODE]; for details, see [IDNA]. Although the output of the ToASCII operation is not used in XMPP, it MUST be possible to apply that operation without failing. 

=== Node Identifier ===
A node identifier MUST be formatted such that the Nodeprep profile of [STRINGPREP] can be applied without failing

Before comparing two node identifiers, an application MUST first ensure that the Nodeprep profile has been applied to each identifier

=== Resource Identifier ===
A resource identifier MUST be formatted such that the Resourceprep profile of [STRINGPREP] can be applied without failing

=== Determination of addresses ===
The receiving entity for a stream MUST determine the initiating entity's JID.

For server-to-server communication, the initiating server's JID MUST be the authorization identity (as defined by [SASL] (Melnikov, A. and K. Zeilenga, “Simple Authentication and Security Layer (SASL),” June 2006.)), either (1) as directly communicated by the initiating server during SASL negotiation (SASL Negotiation) or (2) as derived by the receiving server from the authentication identity if no authorization identity was specified during SASL negotiation (SASL Negotiation). 

For client-to-server communication, the client's bare JID (<node@domain>) MUST be the authorization identity (as defined by [SASL] (Melnikov, A. and K. Zeilenga, “Simple Authentication and Security Layer (SASL),” June 2006.)), either (1) as directly communicated by the client during SASL negotiation (SASL Negotiation) or (2) as derived by the server from the authentication identity if no authorization identity was specified during SASL negotiation (SASL Negotiation). The resource identifier portion of the full JID (<node@domain/resource>) MUST be the resource identifier negotiated by the client and server during resource binding (Resource Binding).

The receiving entity MUST ensure that the resulting JID (including node identifier, domain identifier, resource identifier, and separator characters) conforms to the rules and formats defined earlier in this section; to meet this restriction, the receiving entity MAY replace the JID sent by the initiating entity with the canonicalized JID as determined by the receiving entity. 